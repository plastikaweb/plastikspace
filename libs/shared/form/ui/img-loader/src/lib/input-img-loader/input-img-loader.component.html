<div
  class="relative w-[224px] h-[224px] p-[10px] border-2 border-dashed text-primary border-gray-40 rounded-lg flex items-center justify-center cursor-pointer overflow-hidden outline-none"
  tabindex="0"
  [class.disabled]="disabled()"
  [attr.aria-label]="'Pujar Imatge' + (value() ? ' (actualment: ' + value() + ')' : '')"
  [ngClass]="{ 'border-gray-80 text-secondary-dark bg-black/10': isDragOver() }"
  (dragover)="onDragOver($event)"
  (dragleave)="onDragLeave($event)"
  (drop)="onDrop($event)">
  @if (!value() && !isLoading()) {
    <div class="flex flex-col justify-center items-center p-0 m-0 w-full h-full">
      <mat-icon class="w-[75px] h-[75px] text-[75px] p-0 m-0">upload</mat-icon>
      <span class="text-sm text-center text-balance">Arrastra una imatge aqu√≠</span>
      <span class="text-sm text-center text-balance">o</span>
      <button
        type="button"
        mat-flat-button
        class="w-full sm:w-auto"
        [disabled]="disabled()"
        (click)="openAddFilesDialog()"
        (keydown.enter)="openAddFilesDialog()"
        (keydown.space)="openAddFilesDialog()">
        <mat-icon class="text-lg">image</mat-icon>
        Cerca una imatge
      </button>
    </div>
  }

  @if (value()) {
    <img
      fill
      loading="lazy"
      placeholder="https://placehold.co/224"
      class="absolute top-0 right-0 bottom-0 left-0 w-full h-full object-cover rounded-lg p-[10px]"
      [alt]="title()"
      [ngSrc]="cdnUrl() || ''" />
    <div
      class="flex absolute right-0 bottom-0 left-0 justify-between items-center py-0 rounded-b-lg text-primary-dark bg-white/80 px-sub"
      tabindex="0"
      (focus)="firstActionBtn?.focus()">
      <p class="flex-grow text-sm font-bold truncate">{{ title() }}</p>
      <div class="flex items-center">
        <button
          #firstActionBtn
          type="button"
          mat-icon-button
          [attr.aria-label]="`Editar imatge ${title()}`"
          [disabled]="disabled()"
          (click)="openAddFilesDialog(); $event.stopPropagation()"
          (keydown.enter)="openAddFilesDialog(); $event.stopPropagation()">
          <mat-icon class="text-lg">edit</mat-icon>
        </button>
        <button
          #secondActionBtn
          type="button"
          mat-icon-button
          [attr.aria-label]="`Eliminar imatge ${title()}`"
          [disabled]="disabled()"
          (click)="onDeleteFile(); $event.stopPropagation()"
          (keydown.enter)="onDeleteFile(); $event.stopPropagation()">
          <mat-icon class="text-lg">delete</mat-icon>
        </button>
      </div>
    </div>
  }

  @if (isLoading()) {
    <div
      class="flex absolute flex-col justify-center items-center w-full h-full rounded-lg transition-all duration-300 p-sub">
      <output
        id="upload-progress"
        class="absolute z-10 w-full text-sm font-bold text-center text-white"
        [attr.aria-label]="`Progress de pujada ${progress() || 0}%`"
        [attr.aria-live]="'polite'"
        >{{ progress() || 0 }}%</output
      >
      <mat-progress-spinner
        class="z-10"
        mode="determinate"
        [value]="progress() || 0"
        [attr.aria-label]="`Progress de pujada ${progress() || 0}%`"></mat-progress-spinner>
      <div class="absolute w-full h-full bg-black opacity-80"></div>
    </div>
  }
</div>

<input
  #inputFile
  aria-label="file"
  type="file"
  accept="image/*"
  class="hidden"
  [disabled]="disabled()"
  (change)="onSelectFile($event)" />
